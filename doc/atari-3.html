<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.69">
 <TITLE>Atari specific information for cc65: Memory layout</TITLE>
 <LINK HREF="atari-4.html" REL=next>
 <LINK HREF="atari-2.html" REL=previous>
 <LINK HREF="atari.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="atari-4.html">Next</A>
<A HREF="atari-2.html">Previous</A>
<A HREF="atari.html#toc3">Contents</A>
<HR>
<H2><A NAME="s3">3.</A> <A HREF="atari.html#toc3">Memory layout</A></H2>



<H2><A NAME="ss3.1">3.1</A> <A HREF="atari.html#toc3.1"><CODE>atari</CODE> target</A>
</H2>


<P>The default linker config file assumes that the BASIC ROM is disabled (or
the BASIC cartridge unplugged). This gives a usable memory range of
[$2000-$BC1F]. The library startup code examines the
current memory configuration, which depends on the size of the
installed memory and cartridges. It does so by using the value in
the MEMTOP ($2E5) variable as highest memory address the program
can use. The initial stack pointer, which is the upper bound of
memory used by the program, is set to this value, minus an optionally
defined __RESERVED_MEMORY__ value.</P>
<P>The default load address of $2000 can be changed by creating a custom
linker config file or by using the "--start-addr" cl65 command line
argument or the "--start-addr" or "-S" ld65 command line arguments.</P>
<P>Please note that the first load chunk (which checks the available memory)
will always be loaded at $2E00, regardless of the specified start
address. This address can only be changed by a custom linker config file.</P>
<P>Special locations:</P>
<P>
<DL>
<DT><B>Text screen</B><DD>
<P>The text screen depends on the installed memory size and cartridges
and can be obtained from the SAVMSC variable ($58).</P>

<DT><B>Stack</B><DD>
<P>The C runtime stack is located at MEMTOP and grows downwards,
regardless of how your linker config file is setup.  This
accommodates the different memory configurations of the Atari
machines, as well as having a cartridge installed.  You can override
this behaviour by writing your own crt0.s file and linking it to
your program (see also 
<A HREF="atari-10.html#memhole_final_note">Final note</A>).</P>

<DT><B>Heap</B><DD>
<P>The C heap is located at the end of the program and grows towards the C
runtime stack.</P>

</DL>
</P>


<H2><A NAME="ss3.2">3.2</A> <A HREF="atari.html#toc3.2"><CODE>atarixl</CODE> target</A>
</H2>


<P>The startup code rearranges the memory as follows:</P>
<P>
<OL>
<LI>Sceen memory and display list are moved below the program start address.</LI>
<LI>The ROM is disabled, making the memory in the areas [$C000-$CFFF]
and [$D800-$FFF9] available.</LI>
<LI>Character generator data is copied from ROM to the CHARGEN location specified in the
linker config file.  This is (in the default <CODE>atarixl.cfg</CODE> file) at the same address as
where it is in ROM ($E000, it can be changed, see 
<A HREF="atari-9.html#chargenloc">atarixl chargen location</A>).  With the character generator at $E000, there are two upper memory
areas available, [$D800-$DFFF] and [$E400-$FFF9].</LI>
</OL>
</P>
<P>With the default load address of $2400 this gives a usable memory range of
[$2400-$CFFF].  Note that the default load address for <CODE>atarixl</CODE> is
different (and lower) that the default load address for <CODE>atari</CODE>.  This is no problem since
on the <CODE>atarixl</CODE> target the first load chunk makes sure that the loaded prgram won't overwrite
memory below MEMLO. See 
<A HREF="atari-9.html#xlchunks">atarixl load chunks</A>.</P>

<P>Special locations:</P>
<P>
<DL>
<DT><B>Text screen</B><DD>
<P>The text screen depends on the selected load address ($2400
by default), and resides directly before that address, rounded to the next
lower page boundary.
The screen memory's start address can be obtained from the SAVMSC variable
($58).</P>

<DT><B>Stack</B><DD>
<P>The C runtime stack is located at end of the RAM memory area ($CFFF)
and grows downwards.</P>

<DT><B>Heap</B><DD>
<P>The C heap is located at the end of the program (end of BSS segment) and
grows towards the C runtime stack.</P>

</DL>
</P>



<HR>
<A HREF="atari-4.html">Next</A>
<A HREF="atari-2.html">Previous</A>
<A HREF="atari.html#toc3">Contents</A>
</BODY>
</HTML>
